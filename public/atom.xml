<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Code Infinity]]></title>
  <link href="http://www.orcame.com/atom.xml" rel="self"/>
  <link href="http://www.orcame.com/"/>
  <updated>2014-01-13T22:22:52+08:00</updated>
  <id>http://www.orcame.com/</id>
  <author>
    <name><![CDATA[orcame]]></name>
    <email><![CDATA[orcame@outlook.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[又折腾Linux系统]]></title>
    <link href="http://www.orcame.com/blog/2014/01/13/after-install-ubuntu/"/>
    <updated>2014-01-13T20:42:00+08:00</updated>
    <id>http://www.orcame.com/blog/2014/01/13/after-install-ubuntu</id>
    <content type="html"><![CDATA[<p>最近手痒，mint主题换过之后总是各种问题不断，换回默认的主题又看着那些个方块疙瘩图标实在是碍眼，终于忍不住动手了。</p>

<h2>Fedora</h2>

<p>先是安装了fedora，fedora(gnome)界面简简单单，是我喜欢的风格，只是那个terminal不能背景透明真是很坑爹的(这个要怪gnome的)，非常不方便。<br/>
先来说说broadcom驱动的安装，网上有很多这个教程，均以失败告终。还是官方的比较靠谱，找到这个<a href="http://zh-cn.broadcom.com/support/802.11/linux_sta.php">下载链接</a>，安装方法在README里面。简单来讲，有两种方法</p>

<ol>
<li>通过源文件安装
 这种方法比较繁琐，在上面链接中的<a href="http://zh-cn.broadcom.com/docs/linux_sta/README.txt">README</a>里面有安装过程的说明，如果是和我一样linux小白的话，一定要认真阅读。</li>
<li><p>通过yum安装
 这种方法就比较人性咯，在上面的<a href="http://zh-cn.broadcom.com/docs/linux_sta/README.txt">README</a>里面也是有提及到的，这里也贴出来供欣赏</p>

<pre><code> su -c 'rpm -Uvh 
 http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm 
 http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm'

 su -
 yum update //在这一步的时候总是提示一个错误，说xxx不是xxxx或者没有menifest文件，大概是这个，忘了具体是什么了。这会导致下一个命令找不到kmod-wl，多试几次yum update后，突然成功了。这东西太脆弱！
 yum install kmod-wl
</code></pre></li>
</ol>


<p>再说说显卡驱动的安装，这个总体来说比较折腾了，我按照这个<a href="http://blog.csdn.net/uuleaf/article/details/7637341">博客</a>的方法安装成功了。</p>

<h2>Ubuntu</h2>

<p>严重的强迫症患者就是贱毛病多的，终于还是无法忍受那个不透明的终端了，虽然用的也不多，而且很怀念ubuntu那个经典的主题，最后还是决定换回Ubuntu（12.04）了。<br/>
对于初学者来讲，Ubuntu的确是很方便的，无线和显卡驱动起码不用太费心了。</p>

<h3>换主题</h3>

<p>Unity也许很优秀，但就是看不惯，个人觉得巨难用无比，那么第一步当然是切换回gnome classic主题</p>

<pre><code>sudo apt-get install gnome-panel
</code></pre>

<p>千万别运行那个</p>

<pre><code>sudo apt-get install gnome-shell
</code></pre>

<p>这个家伙会装上那个巨丑无比的gnome最新版的，真的好丑。
装上gnome-panel之后，就可以在登陆界面选择了，怎么选就不解释了。</p>

<h3>sogou输入法</h3>

<p>先删除ibus</p>

<pre><code>sudo apt-get remove ibus
</code></pre>

<p>卸载依赖</p>

<pre><code>sudo apt-get autoremove
</code></pre>

<p>安装输入法</p>

<pre><code>sudo add-apt-repository ppa:fcitx-team/nightly
sudo apt-get update
sudo apt-get install fcitx-sogoupinyin
</code></pre>

<p>剩下的找到fcitx配置，修改当前配置就好了，以您的智慧一看便懂了，友情提示，千万记得将换页修改为<code>,</code>和<code>.</code><br/>
全部搞定只有注销重新登录或者重启一次就可以用了。</p>

<h3>QQ</h3>

<p>以前一直用<a href="https://github.com/xiehuc/pidgin-lwqq">lwqq</a>,这个还是很不错的。这个<a href="https://github.com/xiehuc/pidgin-lwqq">官方链接</a>里面只给出了通过源码的方式安装，并不是很方便，而且通过这种方式，我编译就没有通过。采用这个<a href="https://github.com/xiehuc/pidgin-lwqq/wiki/Install-On-Linux">链接</a>给出的方法，安装成功</p>

<pre><code>$ sudo add-apt-repository ppa:lainme/pidgin-lwqq
$ sudo apt-get update
$ sudo apt-get install pidgin-lwqq
</code></pre>

<h3>ALT+TAB</h3>

<p>这是一个老问题了，切换到gnome桌面环境的Ubuntu12.04 Alt+Tap组合键失效了，这玩笑开大了，还得了了。
解决方法在<a href="https://bugs.launchpad.net/ubuntu/+source/compiz/+bug/971051">这里</a>,贴出来</p>

<pre><code>1. Install packages:
sudo apt-get install compiz-plugins compizconfig-settings-manager
2. Run "ccsm"
3. Scroll down to Window Management and enable (tick) "Application Switcher".
</code></pre>

<hr />

<p>就先写这么多了，以后再贴。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[献给GFW]]></title>
    <link href="http://www.orcame.com/blog/2014/01/12/for-gfw/"/>
    <updated>2014-01-12T16:23:00+08:00</updated>
    <id>http://www.orcame.com/blog/2014/01/12/for-gfw</id>
    <content type="html"><![CDATA[<p>——————/´﻿ ¯/) <br/>
—————&#8211;/—-/ <br/>
—————-/—-/ <br/>
———&#8211;/´¯/&#8217;&#8211;&#8217;/´¯`·<em> <br/>
———-/&#8217;/&#8211;/—-/—&#8211;/¨¯\ <br/>
——&#8211;(&#8216;(———- ¯~/&#8217;&#8211;&#8217;) <br/>
———\————-&#8216;—&#8211;/ <br/>
———-&#8216;&#39;————</em>-·´ <br/>
————\———&#8211;( <br/>
————-\———&#8211;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[通过Javascript上传文件到Azure存储服务器]]></title>
    <link href="http://www.orcame.com/blog/2014/01/02/upload-azure-blob-by-javascript/"/>
    <updated>2014-01-02T19:32:00+08:00</updated>
    <id>http://www.orcame.com/blog/2014/01/02/upload-azure-blob-by-javascript</id>
    <content type="html"><![CDATA[<p>Azure的存储服务目前开通了跨域访问<a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>请求功能，有了这个功能，我们就可以将被本地文件通过javascript上传到azure的存储服务器上了，而这个过程不需要任何服务器端代码就可以完成。你可以到这里看一下<a href="http://www.orcame.com/jquery-blobuploader/">演示效果</a>!下面来看看怎么实现这个功能。</p>

<!--more-->


<h2>准备工具</h2>

<ul>
<li>支持HTML5的浏览器一枚</li>
<li>文本编辑器一个</li>
<li>javascript打字员一名</li>
<li>测试上传用文件若干</li>
</ul>


<h2>准备条件</h2>

<h3>存储服务器</h3>

<p>经过一段时间的试用和测试，Windows Azure Storage的性能和稳定性都是非常高的，访问速度很快，这个我们可以用本次实验的结果给出证明。我选用了Azure中国(MoonCake)的存储服务，数据中心在上海。想要实现通过JS在浏览器端将文件提交到Azure Storage，需要满足以下两个条件。</p>

<ol>
<li>取得Azure Storage的访问权限
 有关这个问题，我前一篇博客已经对SAS做了比较详细的介绍，<a href="http://www.orcame.com/blog/2013/12/29/windows-azure-sas-introduce/">传送门</a>。我们这里采用在Container级别上设置SAS的方式取得对Azure Storage的访问权限</li>
<li>将Azure Storage Account设置为允许跨域请求<br/>
 Azure Storage已经开通了跨域请求功能，详细信息请移步<a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/27/windows-azure-storage-release-introducing-cors-json-minute-metrics-and-more.aspx">这里</a>，默认是关闭的，要想使用这个功能，我们需要对存储账户做一些设置。不幸的是Azure Portal上找不到设置入口，你只能通过API来实现。截止目前(01/03/2014)，MoonCake平台依然不能运行Azure SDK 2.2以上版本(如果你胆敢发布一个基于SDK2.2的Cloud Service，那么MoonCake很生气，后果很严重——不但你的Cloud Service发布失败，而且你的整个Subscription的Portal页面也全挂了)，但亲测在本地运行Azure Storage SDK3.0是可以成功开启MoonCake上Storage的CORS功能的。</li>
</ol>


<p>附上开启CORS功能的API:</p>

<figure class='code'><figcaption><span>为Azure Storage Account开启CORS功能</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">OpenCors</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CloudStorageAccount</span> <span class="n">account</span> <span class="p">=</span> <span class="n">CloudStorageAccount</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
</span><span class='line'>  <span class="n">CloudBlobClient</span> <span class="n">client</span> <span class="p">=</span> <span class="n">account</span><span class="p">.</span><span class="n">CreateCloudBlobClient</span><span class="p">();</span>
</span><span class='line'>  <span class="n">ServiceProperties</span> <span class="n">propers</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">GetServiceProperties</span><span class="p">();</span>
</span><span class='line'>  <span class="n">CorsRule</span> <span class="n">cr</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CorsRule</span><span class="p">();</span>
</span><span class='line'>  <span class="n">cr</span><span class="p">.</span><span class="n">AllowedMethods</span> <span class="p">=</span> <span class="n">CorsHttpMethods</span><span class="p">.</span><span class="n">Put</span> <span class="p">|</span> <span class="n">CorsHttpMethods</span><span class="p">.</span><span class="n">Options</span> <span class="p">|</span> <span class="n">CorsHttpMethods</span><span class="p">.</span><span class="n">Post</span> <span class="p">|</span> <span class="n">CorsHttpMethods</span><span class="p">.</span><span class="n">Delete</span> <span class="p">|</span> <span class="n">CorsHttpMethods</span><span class="p">.</span><span class="n">Get</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cr</span><span class="p">.</span><span class="n">AllowedOrigins</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;[your domain]&quot;</span><span class="p">);</span><span class="c1">//http://www.orcame.com for example</span>
</span><span class='line'>  <span class="n">cr</span><span class="p">.</span><span class="n">AllowedHeaders</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">cr</span><span class="p">.</span><span class="n">MaxAgeInSeconds</span> <span class="p">=</span> <span class="m">200</span><span class="p">;</span>
</span><span class='line'>  <span class="n">propers</span><span class="p">.</span><span class="n">Cors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CorsProperties</span><span class="p">();</span>
</span><span class='line'>  <span class="n">propers</span><span class="p">.</span><span class="n">Cors</span><span class="p">.</span><span class="n">CorsRules</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
</span><span class='line'>  <span class="n">client</span><span class="p">.</span><span class="n">SetServiceProperties</span><span class="p">(</span><span class="n">propers</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>浏览器</h3>

<p>用javascript上传文件我们必须能够取得对本地文件的读取操作，在HTML5之前这是不被允许的，
现代浏览器为我们提供了一个崭新的javascript API，FileReader，这使得我们可以异步的读取本地文件，甚至可以将文件拆分。有关FileReader的用法，我们在接下来的代码环节进行展开。</p>

<h2>功能列表</h2>

<p>本次实验我们要实现的功能如下</p>

<ol>
<li>文件上传</li>
<li>并发控制</li>
<li>断点续传</li>
</ol>


<h2>实验步骤</h2>

<h3>文件上传</h3>

<p>根据前面的分析，想要实现一个文件上传功能，需要用到FileReader对本地文件进行读取，然后通过ajax来发起上传请求到Azure Storage服务器</p>

<p>对于File,FileReader类，这里不做更详细的介绍，仅仅说明一下这里需要用到的方法和事件。</p>

<ul>
<li>File.slice(start,end)
  有关slice方法的详细介绍请参考<a href="http://www.w3.org/TR/FileAPI/#slice-method-algo">这里</a>,简单来讲，就是这个方法可以根据传入的start和end将一个文件拆分成一个块（在js中叫blob，在azure中叫block，而在azure中js中的file叫blob，我勒个去，好绕），假设我们有一个<code>&lt;input type='file'/&gt;</code>控件，那么当我们选定了一个文件之后，是可以通过<code>files[0]</code>取得当前文件的实例的。</li>
<li>FileReader.readAsArrayBuffer(blob)
  惯例，官方文档在<a href="http://www.w3.org/TR/FileAPI/#readAsArrayBuffer">这里</a>,这个方法可以将一个blob(azure中的block)读入到FileReader实例中</li>
<li>FileReader.onloadend(ev)
  <a href="http://www.w3.org/TR/FileAPI/#event-handler-attributes-section">传送门</a>,简单来讲这是一个事件，当上面的readAsArrayBuffer执行结束后会触发这个事件。</li>
</ul>


<p>关于ajax请求如何发送，这里不赘述，请参考jquery<a href="http://api.jquery.com/jquery.ajax/">文档</a></p>

<p>在正式开始之前，我们得先明确几个概念</p>

<ul>
<li>File(JS):指代本地一个文件</li>
<li>Blob(JS):指代本地文件被拆分出的一块，相当于Azure中的Block</li>
<li>Blob(Azure):一个文件，可以由无数个Block组成</li>
<li>Block:无数个Block组成一个Blob</li>
</ul>


<p>为简单起见，本文以下内容，对于文件统称blob，块统称block</p>

<p>说了好多废话，现在开席，上菜了。</p>

<p>有了上面的介绍，一个内容上传的功能就很容易实现了，且看代码</p>

<figure class='code'><figcaption><span>上传block代码</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">sendBlock</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">beforeSend</span><span class="p">,</span> <span class="nx">progress</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">url</span><span class="o">:</span> <span class="nx">block</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="nx">block</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">processData</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">xhr</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">_xhr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSettings</span><span class="p">.</span><span class="nx">xhr</span><span class="p">();</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">_xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">_xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="c1">//这里为了获取上传进度，我们添加了progress事件，在事件中可以做一些UI上的进度显示功能</span>
</span><span class='line'>                  <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                      <span class="k">if</span> <span class="p">(</span><span class="nx">progress</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                          <span class="nx">progress</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="nx">ev</span><span class="p">.</span><span class="nx">loaded</span><span class="p">,</span><span class="nx">ev</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">}</span>
</span><span class='line'>                  <span class="p">}</span>
</span><span class='line'>              <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">_xhr</span><span class="p">;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">block</span><span class="p">.</span><span class="nx">status</span><span class="o">=</span><span class="s1">&#39;uploading&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;x-ms-blob-type&#39;</span><span class="p">,</span> <span class="s1">&#39;BlockBlob&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">beforeSend</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="c1">//在上传开始之前，你可以通过这个事件做一些小动作</span>
</span><span class='line'>              <span class="nx">beforeSend</span><span class="p">(</span><span class="nx">xhr</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">sta</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">block</span><span class="p">.</span><span class="nx">status</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="c1">//上传成功后，用这个方法通知UI</span>
</span><span class='line'>              <span class="nx">success</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">desc</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">block</span><span class="p">.</span><span class="nx">status</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="c1">//同理，失败了用这个方法通知UI</span>
</span><span class='line'>              <span class="nx">error</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">desc</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面就是一个最基本的block上传功能，如果要实现一个blob的上传,我们还需要做进一步的改进。首先就需要对blob进行拆分，因为azure的storage对block的大小有个限制，最大不能超过4M，所以我们的拆分上限就是4M。
有了上面的代码片段，实现一个blob的上传就很容易了，我们可以传入success方法，在前一个block上传成功了之后继续上传下一个block，直到所有block全部上传完毕。下面仅仅给出逻辑实现：</p>

<figure class='code'><figcaption><span>上传一个blob</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">_blob</span><span class="p">;</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">success</span><span class="o">=</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">block</span> <span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">blob</span><span class="p">.</span><span class="nx">nextBlock</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">block</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//在这里，我们做一个递归调用，一旦block上传完毕，就继续上传下一个block，直到所有block都完成为止。</span>
</span><span class='line'>      <span class="nx">sendBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="c1">//所有Block都上传完成了，这里需要做一个commit动作，就是通知azure storage，我刚刚上传的那些block是属于同一个blob的，请合并。</span>
</span><span class='line'>      <span class="nx">commitBlob</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blob</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">error</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//预留占位 </span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">commitBlob</span><span class="p">(</span><span class="nx">blob</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;&amp;comp=blocklist&#39;</span>
</span><span class='line'>      <span class="p">,</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>      <span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//blob的commit需要提供一个blockid列表，这个列表中的所有项的长度必须一致，并且顺序不能错乱</span>
</span><span class='line'>    <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;BlockList&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&lt;Latest&gt;&#39;</span> <span class="o">+</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&lt;/Latest&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&lt;/BlockList&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">url</span><span class="o">:</span> <span class="nx">uri</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;x-ms-blob-content-type&#39;</span><span class="p">,</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">sta</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">success</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">sta</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">desc</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">error</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">desc</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">_block</span><span class="o">=</span><span class="nx">_blob</span><span class="p">.</span><span class="nx">nextBlock</span><span class="p">();</span>
</span><span class='line'><span class="nx">sendBlock</span><span class="p">(</span><span class="nx">_block</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span><span class="c1">//这里开始上传</span>
</span></code></pre></td></tr></table></div></figure>


<p>通过上面这两段简单的代码，我们就可以实现一个文件的上传操作了。总结起来的步骤就是</p>

<ol>
<li>根据设定的blockSize从blob中取得下一个block</li>
<li>上传block</li>
<li>如果blob中还有block，回到1，否则到4</li>
<li>commit刚刚上传的blob</li>
</ol>


<h3>并发控制</h3>

<p>上面的步骤只是实现了最基本的上传功能，并且上传是单线程按序进行的，就是说一个文件同时只有一个block在上传，之后这个block上传成功了，下一个block才会开始上传。那么如果我想同时上传多个文件，并且同一个文件也可以多个block同时上传该怎么办呢？</p>

<p>因为在ajax的请求中，所有动作都是异步的，那么有很多事情我们需要在回调函数中才能处理，这也是为什么上面的代码对外开放了success和error两个事件回调的主要原因。</p>

<p>对于单个文件的上传，要支持多请求并发是比较容易实现的，可以设想一个请求计数器，初始值为我们预设的最大请求数量。设定一个循环，每发起一个请求，计数器自减1，每个请求成功了之后，同样是按照上面的规则，如果还有block，就开启一个新的请求,需要注意的是，只有所有的block全部上传成功了，我们才能进行blob的commit操作,需要对success方法做一个小改动。</p>

<figure class='code'><figcaption><span>并发上传blob</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">maxThread</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">blobUploadFinished</span><span class="p">(</span><span class="nx">blob</span><span class="p">){</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">idx</span><span class="o">&lt;</span><span class="nx">blob</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">idx</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">status</span><span class="o">!=</span><span class="s1">&#39;success&#39;</span><span class="p">){</span>
</span><span class='line'>          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">success</span><span class="o">=</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">blob</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">blob</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">block</span> <span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">blob</span><span class="p">.</span><span class="nx">nextBlock</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">block</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//这里开启一个新的请求上传获取到的下一个block</span>
</span><span class='line'>      <span class="nx">sendBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">blobUploadFinished</span><span class="p">(</span><span class="nx">blob</span><span class="p">)){</span><span class="c1">//所有block都上传成功了，再commit</span>
</span><span class='line'>          <span class="nx">commitBlob</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="nx">maxThread</span><span class="o">==-</span><span class="mi">1</span> <span class="o">||</span> <span class="nx">maxThread</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">//maxThread = -1意味着无限定，所有block可以同时上传，强烈不建议这样做，实测400M+的文件导致chrome崩溃(电脑配置也比较烂)</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">block</span> <span class="o">=</span><span class="nx">_blob</span><span class="p">.</span><span class="nx">nextBlock</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">block</span><span class="p">){</span>     
</span><span class='line'>      <span class="nx">sendBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">maxThread</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">maxThread</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>一个blob的多请求并发上传功能实现了，那么如果我想对多个blob进行处理该怎么办呢？其实原理也是一样的，还是有一个最大请求限定，只不过我们需要事先将所有的blob放入一个数组，上面的while循环就多了一步验证所有blob是否全部没有待上传block的步骤。</p>

<figure class='code'><figcaption><span>并发上传多个blob</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">blobs</span><span class="o">=</span><span class="p">[];</span>
</span><span class='line'><span class="c1">//push all your blob in blobs here.</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">nextBlock</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">blobs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">idx</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">idx</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">block</span><span class="o">=</span><span class="nx">blobs</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">nextBlock</span><span class="p">();</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">block</span><span class="p">){</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">block</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="nx">maxThread</span><span class="o">==-</span><span class="mi">1</span> <span class="o">||</span> <span class="nx">maxThread</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">block</span> <span class="o">=</span><span class="nx">nextBlock</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">block</span><span class="p">){</span>     
</span><span class='line'>      <span class="nx">sendBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">maxThread</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">maxThread</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>断点续传</h3>

<p>细心的会很快发现，我们上面的代码都是围绕着success回调方法做一些简单的改动就可以实现单线程或者并发的上传操作，那么断点续传该怎样处理呢？bingo，答对了，error回调方法可以很好的帮我们解决这个问题。
断点续传的简单思路就是将那些上传失败的block重新上传，直到所有block全部上传成功了，才结束提交blob，结束整个上传过程。</p>

<figure class='code'><figcaption><span>一个简单error回调的实现</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">error</span><span class="p">(){</span>
</span><span class='line'><span class="nx">sendBlock</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个error回调真是简单到极致了，总觉得哪里有问题，不是么？当我有多个文件需要上传，而因为某种原因，这个block总是失败怎么办？那么他走时占用一个请求，循环啊循环，永无止境。我们做个小改动试试看。</p>

<figure class='code'><figcaption><span>改进的error回调</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">error</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">blob</span><span class="p">.</span><span class="nx">addErrorBlock</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">block</span><span class="o">=</span><span class="nx">nextBlock</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">sendBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">success</span><span class="p">,</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在这段代码中，我们将失败的block加入到blob的失败列表中，接着从blob列表中获取取下一个可用的block进行上传。
这样我们就实现了简单的断点续传功能。</p>

<h3>补充说明</h3>

<p>下面我们补充一下上面用到的但还没有见到长什么样子的代码。</p>

<figure class='code'><figcaption><span>久违的blob和block</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="nx">containerUrl</span><span class="p">,</span><span class="nx">blockSize</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">file</span><span class="o">=</span><span class="nx">file</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">qidx</span><span class="o">=</span><span class="nx">containerUrl</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">blobUrl</span><span class="o">=</span><span class="nx">containerUrl</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">qidx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span><span class="c1">//记录blob的链接</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">blobUrl</span> <span class="o">+</span> <span class="nx">containerUrl</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">qidx</span><span class="p">);</span><span class="c1">//记录blob包括sas的链接</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">blockSize</span><span class="o">=</span><span class="nx">blockSize</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">errorBlocks</span><span class="o">=</span><span class="p">[];</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="o">=</span><span class="p">[];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">blob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nextBlock</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">file</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">file</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pointer</span><span class="o">&lt;</span><span class="nx">file</span><span class="p">.</span><span class="nx">size</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">_block</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pointer</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">pointer</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">fileSize</span><span class="p">);</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">pointer</span><span class="o">+=</span><span class="nx">_block</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nx">block</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">_block</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">errorBlocks</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">blob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addErrorBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">errorBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">block</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">padstr</span><span class="p">(</span><span class="nx">num</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">+</span><span class="nx">num</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">str</span><span class="o">+=</span><span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">num</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">block</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">blob</span><span class="p">,</span><span class="nx">fileSlice</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">blob</span><span class="o">=</span><span class="nx">blob</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="o">=</span><span class="nx">fileSlice</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">blob</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">=</span><span class="nx">btoa</span><span class="p">(</span><span class="s2">&quot;block-&quot;</span> <span class="o">+</span> <span class="nx">pad</span><span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">)).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/=/g</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="o">=</span><span class="nx">blob</span><span class="p">.</span><span class="nx">url</span><span class="o">+</span><span class="s1">&#39;&amp;comp=block&amp;blockid=&#39;</span> <span class="o">+</span> <span class="nx">block</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意</strong>文章中的代码片段只是提供一个思路，如果您需要完整的代码，请参考我github上的一个<a href="https://github.com/orcame/jquery-blobuploader">jquery插件</a>。</p>

<h2>测试</h2>

<p>我写了一个简单的测试页面，截图如下：
<img src="http://www.orcame.com/images/image-post/blobuploader-0.png"></p>

<p>添加几个文件，做个简单的测试后，得到的数据如下</p>

<table>
<thead>
<tr>
<th>文件大小</th>
<th>Block Size</th>
<th>Max Thread</th>
<th>最大速度</th>
<th>最小速度</th>
<th>平均速度</th>
</tr>
</thead>
<tbody>
<tr>
<td>364M</td>
<td>2M</td>
<td>20</td>
<td>170M/S</td>
<td>54K/S</td>
<td>9.8M/S</td>
</tr>
<tr>
<td>693M</td>
<td>2M</td>
<td>20</td>
<td>290M/S</td>
<td>126K/S</td>
<td>12M/S</td>
</tr>
<tr>
<td>693M</td>
<td>4M</td>
<td>10</td>
<td>550M/S</td>
<td>59K/S</td>
<td>11.8M/S</td>
</tr>
<tr>
<td>1.35M</td>
<td>4M</td>
<td>10</td>
<td>4M/S</td>
<td>110K/S</td>
<td>680K/S</td>
</tr>
</tbody>
</table>


<p>统计结果中最大速度波动比较大，这个基本都是瞬时速度，不具备什么参考价值。也有可能我统计的方式不对！</p>

<h2>后记</h2>

<p>这之后有做过一些测试，这个和当前的网络情况有很大关系，每隔一段时间，测试的结果波动都非常大。后来在Azure上面建了一个虚拟机，通过走数据中心内部的网络进行测试，对于135M左右的文件，基本稳定在5s以内可以上传完毕，这个速度还是非常可观的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用markdown问题汇总]]></title>
    <link href="http://www.orcame.com/blog/2013/12/30/markdown-issue-list/"/>
    <updated>2013-12-30T21:09:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/12/30/markdown-issue-list</id>
    <content type="html"><![CDATA[<p>这个博客（基于<a href="https://github.com/imathis/octopress">Octopress</a>）搭建已经有一段时间了，一直没怎么写，一是因为自己很懒，二也是因为一直不知道写什么，最近强迫自己写一些东西，因为有些内容还是值得记录下来的，权当做备忘录来使用。</p>

<p>这几天用<a href="http://en.wikipedia.org/wiki/Markdown">markdown</a>的过程中碰到了一些问题的，既然我能遇到这些问题，我相信也有其他人会遇到相似的问题，这里做个简单的记录，这篇博客也会在后续的使用当中不断更新。</p>

<!--more-->


<h3>列表为何无法正确显示</h3>

<p>第一个问题就是列表始终无法正确显示出来，譬如，我书写的是</p>

<pre><code>1. item1
2. item2
3. item3
</code></pre>

<p>最后generate出来的结果却是</p>

<pre><code>1. item12. item23. item3
</code></pre>

<p>无论我在每个点(.)后面预留多少个空格或者制表符，都无法得到想要的结果。无序列表也存在同样的问题。
解决方法是需要在每个列表块之前添加一个空白行，就像这样。</p>

<pre><code>&lt;!--这里放置一个空行--&gt;
1. item1
2. item2
3. item3
</code></pre>

<h3>相邻两个列表块被合并了</h3>

<p>问题总是一个接着一个的，当我需要书写两个相邻的列表块的时候，出来的结果总是被合并成一个，即便一个是有序列表，一个是无序列表。
例如，我这样写</p>

<pre><code>1. item1 on list1
2. item2 on list1
3. item3 on list1

+ item1 on list2
+ item2 on list2
+ item2 on list2
</code></pre>

<p>出来的结果是这样的</p>

<ol>
<li>item1 on list1</li>
<li>item2 on list1</li>
<li><p>item3 on list1</p></li>
<li><p>item1 on list2</p></li>
<li>item2 on list2</li>
<li>item2 on list2</li>
</ol>


<p>这是一个很讨厌的问题，正要google的时候，突然，脑门上划过一道闪电，如果为两个列表块之间添加一个注释会怎么样？</p>

<pre><code>1. item1 on list1
2. item2 on list1
3. item3 on list1
&lt;!--大哥，我想要两个列表块--&gt;
+ item1 on list2
+ item2 on list2
+ item2 on list2
</code></pre>

<p>结果是，我真的得到了两个列表块.(^o^)/~</p>

<ol>
<li>item1 on list1</li>
<li>item2 on list1</li>
<li>item3 on list1</li>
</ol>


<!--大哥，我想要两个列表块-->


<ul>
<li>item1 on list2</li>
<li>item2 on list2</li>
<li>item2 on list2</li>
</ul>


<h3>如何在列表中显示代码块</h3>

<p>如果想把代码块嵌入列表中，那么你需要在代码块前面加一个空行，这个代码块前面的缩进至少为8个空格或者两个制表符，就像这样</p>

<pre><code>+ item 1
        &lt;!--这里有个空行--&gt;
&lt;!--这里两个制表符--&gt;code block under item1
+ item 2
        &lt;!--这里有个空行--&gt;
&lt;!--或者8个空格--&gt;code block under item2
</code></pre>

<p>显示的结果就是这样的</p>

<ul>
<li><p>item 1</p>

<pre><code>  code block under item1
</code></pre></li>
<li><p>item 2</p>

<pre><code>  code block under item2
</code></pre></li>
</ul>


<p>如果你想要将</p>

<pre><code>``` langname description 
```
</code></pre>

<p>这种形式书写的代码块嵌入列表项中，我没有找到方法，我的判断是不可以，至少目前是这样。</p>

<h3>如何显示table</h3>

<p>目前为止，我还没有遇到需要写用table表达的内容的情况，这里纯粹好奇。
table是这样写的</p>

<pre><code>header1|header2|header3
---|---|---|
cell11|cell12|cell13
cell21|cell22|cell23
</code></pre>

<p>出来的结果是</p>

<table>
<thead>
<tr>
<th>header1</th>
<th>header2</th>
<th>header3</th>
</tr>
</thead>
<tbody>
<tr>
<td>cell11</td>
<td>cell12</td>
<td>cell13</td>
</tr>
<tr>
<td>cell21</td>
<td>cell22</td>
<td>cell23</td>
</tr>
</tbody>
</table>


<p>这里需要注意，这个<code>table</code>的<code>html</code>就是由纯粹的<code>&lt;table&gt;</code>,<code>&lt;thead&gt;</code>,<code>&lt;tbody&gt;</code>,<code>&lt;tr&gt;</code>,<code>&lt;td&gt;</code>等组成的，是没有诸如<code>class</code>等任何属性的，所以你看到的会是这个样子，那么如何为<code>table</code>添加<code>class</code>属性呢？我不知道，网上也有很多人再问这个问题了，现在比较通用的答案呢，都是为全局的<code>table</code>设置一个样式，譬如，加一个这样的样式表</p>

<figure class='code'><figcaption><span>table style</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.entry-content</span> <span class="nt">table</span><span class="p">{</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">100</span><span class="o">%</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span><span class="m">1px</span> <span class="k">solid</span> <span class="m">#333</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.entry-content</span> <span class="nt">table</span> <span class="nt">thead</span><span class="p">{</span>
</span><span class='line'>  <span class="c">/*thead style here*/</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c">/*other style, tbody, tr, td and so on*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个解决方案虽然比较ugly，但的确是可以解决这个问题的，我因为偷懒，没有加这个样式。也许将来有一天我突然勤快一下，你会看到这个table变样了。
另外，如果你想让一个单元格占据多行或者多列，（设置<code>colspan</code>或者<code>rowspan</code>),那么别想了，没有这个功能，或者你可以直接写html嵌入markdown文件。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows Azure Shared Access Signature简介]]></title>
    <link href="http://www.orcame.com/blog/2013/12/29/windows-azure-sas-introduce/"/>
    <updated>2013-12-29T22:26:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/12/29/windows-azure-sas-introduce</id>
    <content type="html"><![CDATA[<h2>What</h2>

<p>Shared Access Signature(SAS),共享访问签名，是用于提供对Windows Azure Storage中的Container，Blob，Table以及Queue在特定时间范围内进行有限权限访问的URL。</p>

<!--more-->


<h2>Why</h2>

<p>通常情况下，对Azure Storage的访问是通过账户名和密钥来实现的，这样的认证方式赋予了使用者包括增删改在内的最大的访问权限，而实际应用当中，有许多场景是希望能够限定用户的权限的，比方常见的只读权限，并且也不希望将密钥泄露给用户，这样存在很大的安全隐患。使用SAS可以很好的解决这个问题。</p>

<h2>How</h2>

<h3>功能介绍</h3>

<p>SAS提供的功能包括</p>

<h5>For Blob</h5>

<ul>
<li>读写Blob及其属性和元数据</li>
<li>删除、租赁和创建 Blob 快照</li>
<li>读取Container的Blob列表</li>
</ul>


<h5>For Table</h5>

<ul>
<li>增、删、改、查(version>=&#8217;2012-02-12&#8217;可用)</li>
</ul>


<h5>For Queue</h5>

<ul>
<li>增删改队列消息(version>=&#8217;2012-02-12&#8217;可用)</li>
<li>读取队列元数据，消息计数(version>=&#8217;2012-02-12&#8217;可用)</li>
</ul>


<h3>表现形式</h3>

<p>一个典型的SAS(以Blob为例)为如下形式</p>

<pre><code>https://demostorage.blob.core.chinacloudapi.cn/normal/sasdemo.txt?sv=2013-08-15&amp;sr=b&amp;sig=JqcAqJxPDYn37QU68Xs8dBu0PsoT%2FpkkOE7ShHRstWI%3D&amp;st=2013-12-30T03%3A20%3A05Z&amp;se=2013-12-30T04%3A43%3A25Z&amp;sp=rwd
</code></pre>

<p>由以下几部分组成</p>

<ol>
<li><p>Blob URL</p>

<pre><code> https://demostorage.blob.core.chinacloudapi.cn/normal/sasdemo.txt
</code></pre>

<p>Blob文件的网络路径</p></li>
<li><p>Storage Service Version</p>

<pre><code> sv=2013-08-15
</code></pre>

<p>这是在2012-02-12版本后新加的一个参数，用来标识Storage Service所使用的版本</p></li>
<li><p>Start Time</p>

<pre><code> st=2013-12-30T03%3A20%3A05Z
</code></pre>

采用<a href="http://www.google.com.hk/#newwindow=1&amp;q=ISO+8061&amp;safe=strict">ISO8061</a>格式表示的日期，用来标识该SAS生效的起始时间，可以省略（注意，不是为空，表示立即生效)。
官方文档上说采用的是<a href="http://www.google.com.hk/#newwindow=1&amp;q=ISO+8061&amp;safe=strict">ISO8061</a>格式，我查了半天没找到<a href="http://www.google.com.hk/#newwindow=1&amp;q=ISO+8061&amp;safe=strict">ISO8061</a>,只有<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO8601</a>，API产生的字符串是符合<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO8601</a>的规范的，这里很有可能是<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO8601</a>才对。
附上<a href="http://www.windowsazure.com/en-us/manage/services/storage/net/shared-access-signature-part-1/">官方文档</a>原文

<blockquote><p>Specified in an ISO 8061 format. If you want the SAS to be valid immediately, omit the start time.</p></blockquote></li>
<li><p>Expiry Time</p>

<pre><code> se=2013-12-30T04%3A43%3A25Z
</code></pre>

<p>采用<a href="http://www.google.com.hk/#newwindow=1&amp;q=ISO+8061&amp;safe=strict">ISO8061</a>格式(疑问同上)表示的日期，用来标识该SAS失效时间，这个参数是必须的
注意，在2012-02-12以前的版本中，SAS默认的有效时长最长1小时，也就是说即便你设定的st和se之间的差值为大于一小时的任何时长，该SAS还是会在1小时后自动失效</p></li>
<li><p>Resource</p>

<pre><code> sr=b
</code></pre>

<p>表明该资源是一个Blob</p></li>
<li><p>Permissions</p>

<pre><code> sp=rwd
</code></pre>

<p>该SAS链接拥有的权限，这里是读、写和删除。</p></li>
<li><p>Signature</p>

<pre><code> sig=JqcAqJxPDYn37QU68Xs8dBu0PsoT%2FpkkOE7ShHRstWI%3D
</code></pre>

<p>用于验证对Blob访问的签名</p></li>
</ol>


<!--stop list-->


<h3>SAS与SAP</h3>

<p>可以通过两种方式来创建共享访问签名:</p>

<ul>
<li>独立的SAS（Ad Hoc SAS)<br/>
这个没什么好说的，前面已经做了很多介绍，后面会有代码演示如何创建。</li>
<li>引用SAP（Shared Access Policy，共享访问策略）的SAS<br/>
这里需要先介绍下什么是SAP，SAP的组成形式和SAS是一样的，不同的是SAP是定义在容器，也就是Container、Queue以及Table，级别上的，SAP需要有一个名称，也可以随时被删除（即便Expiry Time还没有到），删除即失效。</li>
</ul>


<h3>失效</h3>

<p>使用SAS的一个关键问题就是何时失效，上面已经有了这方面的介绍，这里做个小结</p>

<ul>
<li>SAS指定的失效时间到了</li>
<li>SAS引用的SAP的失效时间到了<br/>
有两种情况可以导致SAP失效时间到，一是SAP指定的失效时间过了，二是管理员更改了SAP的设定，使其失效时间指向了一个已经过去的时间（这是回收SAP的一种方式）。</li>
<li>SAS引用的SAP被删除了<br/>
这是回收SAP的另外一种方式，<strong>如果你删掉了一个未过期的SAP，之后又创建了另一个同名的有效（未过期）SAP，那么所有引用了该SAP的SAS会继续生效</strong>（注意，此时原继承的过期时间仍然未到），所以为避免发生未预期的错误，需要注意用不同的名字创建SAP</li>
<li>创建SAS的账号密钥被重置<br/>
这种情况下，所有使用该密钥创建的SAP，SAS都会失效。<strong>慎用</strong></li>
</ul>


<h3>使用</h3>

<p>下面用代码片段讲解一下如何使用SAS，Window Aure提供了丰富的API来帮助我们实现该功能，这里以.Net平台，C#语言为例</p>

<h4>Ad hoc SAS</h4>

<p>SAS可以创建在Container上</p>

<figure class='code'><figcaption><span>为Container创建SAS</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="kt">string</span> <span class="nf">GenerateContainerSasUri</span><span class="p">(</span><span class="kt">string</span> <span class="n">containerName</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">DateTime</span> <span class="n">expiryTime</span><span class="p">,</span> <span class="n">SharedAccessBlobPermissions</span> <span class="n">permission</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">SharedAccessBlobPolicy</span> <span class="n">sasConstraints</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SharedAccessBlobPolicy</span><span class="p">();</span>
</span><span class='line'>    <span class="n">sasConstraints</span><span class="p">.</span><span class="n">SharedAccessStartTime</span> <span class="p">=</span> <span class="n">startTime</span><span class="p">;</span>
</span><span class='line'>    <span class="n">sasConstraints</span><span class="p">.</span><span class="n">SharedAccessExpiryTime</span> <span class="p">=</span> <span class="n">expiryTime</span><span class="p">;</span>
</span><span class='line'>    <span class="n">sasConstraints</span><span class="p">.</span><span class="n">Permissions</span> <span class="p">=</span> <span class="n">permission</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CloudBlobContainer</span> <span class="n">container</span> <span class="p">=</span> <span class="n">GetContainer</span><span class="p">(</span><span class="n">containerName</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">sas</span> <span class="p">=</span> <span class="n">container</span><span class="p">.</span><span class="n">GetSharedAccessSignature</span><span class="p">(</span><span class="n">sasConstraints</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">container</span><span class="p">.</span><span class="n">Uri</span> <span class="p">+</span> <span class="n">sas</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>也可以创建在Blob上</p>

<figure class='code'><figcaption><span>为Blob创建SAS</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="kt">string</span> <span class="nf">GenerateBlobSasUri</span><span class="p">(</span><span class="kt">string</span> <span class="n">containerName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">blobName</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">DateTime</span> <span class="n">expiryTime</span><span class="p">,</span> <span class="n">SharedAccessBlobPermissions</span> <span class="n">permission</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CloudBlobContainer</span> <span class="n">container</span> <span class="p">=</span> <span class="n">GetContainer</span><span class="p">(</span><span class="n">containerName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CloudBlockBlob</span> <span class="n">blob</span> <span class="p">=</span> <span class="n">container</span><span class="p">.</span><span class="n">GetBlockBlobReference</span><span class="p">(</span><span class="n">blobName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">SharedAccessBlobPolicy</span> <span class="n">sasConstraints</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SharedAccessBlobPolicy</span><span class="p">();</span>
</span><span class='line'>    <span class="n">sasConstraints</span><span class="p">.</span><span class="n">SharedAccessStartTime</span> <span class="p">=</span> <span class="n">startTime</span><span class="p">;</span>
</span><span class='line'>    <span class="n">sasConstraints</span><span class="p">.</span><span class="n">SharedAccessExpiryTime</span> <span class="p">=</span> <span class="n">expiryTime</span><span class="p">;</span>
</span><span class='line'>    <span class="n">sasConstraints</span><span class="p">.</span><span class="n">Permissions</span> <span class="p">=</span> <span class="n">permission</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">string</span> <span class="n">sas</span> <span class="p">=</span> <span class="n">blob</span><span class="p">.</span><span class="n">GetSharedAccessSignature</span><span class="p">(</span><span class="n">sasConstraints</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">blob</span><span class="p">.</span><span class="n">Uri</span> <span class="p">+</span> <span class="n">sas</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>那么调用</p>

<pre><code>signature = GenerateContainerSasUri(containerName,startTime, endTime, SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.Write);
</code></pre>

<p>或者调用</p>

<pre><code>signature = provider.GenerateBlobSasUri(containerName, blobName, startTime, endTime, SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.Write);
</code></pre>

<p>返回的结果就是形如我们上面提到的典型SAS的一个URL</p>

<pre><code>https://demostorage.blob.core.chinacloudapi.cn/normal/sasdemo.txt?sv=2013-08-15&amp;sr=b&amp;sig=JqcAqJxPDYn37QU68Xs8dBu0PsoT%2FpkkOE7ShHRstWI%3D&amp;st=2013-12-30T03%3A20%3A05Z&amp;se=2013-12-30T04%3A43%3A25Z&amp;sp=rwd
</code></pre>

<p>基于SAP的SAS的创建方法略有不同，我们需要首先创建一个SAP，注意，SAP是只能创建在容器(Container,Table,Queue)上的，并且可以随时删除。这里仍然以Container为例。</p>

<figure class='code'><figcaption><span>为Container创建SAP</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">//没有返回值</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">SetContainerSap</span><span class="p">(</span><span class="kt">string</span> <span class="n">containerName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">policyName</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">DateTime</span> <span class="n">expiryTime</span><span class="p">,</span> <span class="n">SharedAccessBlobPermissions</span> <span class="n">permission</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CloudBlobContainer</span> <span class="n">container</span> <span class="p">=</span> <span class="n">GetContainer</span><span class="p">(</span><span class="n">containerName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">SharedAccessBlobPolicy</span> <span class="n">sharedPolicy</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SharedAccessBlobPolicy</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">SharedAccessStartTime</span> <span class="p">=</span> <span class="n">startTime</span><span class="p">,</span>
</span><span class='line'>        <span class="n">SharedAccessExpiryTime</span> <span class="p">=</span> <span class="n">expiryTime</span><span class="p">,</span>
</span><span class='line'>        <span class="n">Permissions</span> <span class="p">=</span> <span class="n">permission</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="n">BlobContainerPermissions</span> <span class="n">permissions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BlobContainerPermissions</span><span class="p">();</span>
</span><span class='line'>    <span class="n">permissions</span><span class="p">.</span><span class="n">SharedAccessPolicies</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span><span class='line'>    <span class="n">permissions</span><span class="p">.</span><span class="n">SharedAccessPolicies</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">policyName</span><span class="p">,</span> <span class="n">sharedPolicy</span><span class="p">);</span><span class="c1">//SAP需要一个Name</span>
</span><span class='line'>    <span class="n">container</span><span class="p">.</span><span class="n">SetPermissions</span><span class="p">(</span><span class="n">permissions</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>删除SAP</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">RemoveContainerSap</span><span class="p">(</span><span class="kt">string</span> <span class="n">containerName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">policyName</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CloudBlobContainer</span> <span class="n">container</span> <span class="p">=</span> <span class="n">GetContainer</span><span class="p">(</span><span class="n">containerName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">BlobContainerPermissions</span> <span class="n">permissions</span> <span class="p">=</span> <span class="n">container</span><span class="p">.</span><span class="n">GetPermissions</span><span class="p">();</span>
</span><span class='line'>    <span class="n">permissions</span><span class="p">.</span><span class="n">SharedAccessPolicies</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">policyName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">container</span><span class="p">.</span><span class="n">SetPermissions</span><span class="p">(</span><span class="n">permissions</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果我们需要创建一个基于SAP的SAS就可以这样子来做</p>

<figure class='code'><figcaption><span>为Blob创建基于SAP的SAS</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="kt">string</span> <span class="nf">GenerateBlobSasUri</span><span class="p">(</span><span class="kt">string</span> <span class="n">containerName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">blobName</span><span class="p">,</span><span class="kt">string</span> <span class="n">policyName</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CloudBlobContainer</span> <span class="n">container</span> <span class="p">=</span> <span class="n">GetContainer</span><span class="p">(</span><span class="n">containerName</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CloudBlockBlob</span> <span class="n">blob</span> <span class="p">=</span> <span class="n">container</span><span class="p">.</span><span class="n">GetBlockBlobReference</span><span class="p">(</span><span class="n">blobName</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//这里我们没有传入policy参数，只是指定了一个SAP的名称(policyName),这样SAS会继承SAP的设定</span>
</span><span class='line'>    <span class="kt">string</span> <span class="n">sas</span> <span class="p">=</span> <span class="n">blob</span><span class="p">.</span><span class="n">GetSharedAccessSignature</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="n">policyName</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">blob</span><span class="p">.</span><span class="n">Uri</span> <span class="p">+</span> <span class="n">sas</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>为Container创建基于SAP的SAS方法是类似的，留给大家自己练习。</p>

<hr />

<p><strong><center>——未完待续中——</center></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何在多台电脑上使用Octopress写博客]]></title>
    <link href="http://www.orcame.com/blog/2013/12/26/octopress-multi-compoter/"/>
    <updated>2013-12-26T13:56:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/12/26/octopress-multi-compoter</id>
    <content type="html"><![CDATA[<p>英文好的，请直接猛击<a href="http://blog.zerosharp.com/clone-your-octopress-to-blog-from-two-places/">这里</a>。英文不好的，就听我啰嗦几句。</p>

<p>先来讲讲基础知识，我们需要有两个branch，一个叫<code>master</code>，这个是默认的，不能改，被存储在blog根目录的<code>_deploy</code>文件夹下，是用来存放生成好的blog站点文件的。另一个叫<code>source</code>(名字可以自己定义，此文中指定为<em>source</em>),是用来存放markdown源文件，theme，plugin等用于生成blog所需要的所有文件的。</p>

<!--more-->


<p>如果你是按照<a href="http://www.orcame.com/blog/2013/03/02/hello-git-world/">这个</a>方式创建的博客，那么你远端是没有<code>source</code>分支的(如果远端已经创建<code>source分</code>支,请略过)。首先需要创建一个<code>source</code>分支，在本地blog根目录下执行</p>

<pre><code>git branch source   //创建本地source分支
git checkout source //切换本地分支到source
git add --all           //将所有文件add到source分支
git commit -m "init"    //commit
git push origin source  //将source分支push到服务器
</code></pre>

<p>这样便将本地所有源文件(除了<code>_deploy</code>文件夹下的内容)push到远端的<code>source</code>分支了</p>

<p>换一台电脑，将远端<code>source</code>分支clone到本地</p>

<pre><code>git clone -b source git@github.com:xxxxx
</code></pre>

<p>可以发现，在blog根目录中<code>_deploy</code>文件夹(可能没有)是空的(如果不是空的，请清空)，下一步是将远端<code>master</code>分支clone到本地的_deploy文件夹</p>

<pre><code>git clone -b master git@github.com:xxxxx _deploy
</code></pre>

<p>然后需要做一些安装配置的步骤</p>

<pre><code>gem install bundler
bundle install
</code></pre>

<p>接下来<code>rake generate</code>就可以生成blog文件了。</p>

<p>需要注意的是，做完任何更改后（例如新增了一篇文章），需要提交到<code>source</code>分支</p>

<pre><code>git add .
git commit -am "Some comment here." 
git push origin source  # update the remote source branch 
</code></pre>

<p>然后<code>rake deploy</code>来发布blog。</p>

<p>当切换到另外一台电脑时候，同样需要把远端<code>source</code>和<code>master</code>分支的新内容pull到本地</p>

<pre><code>cd octopress
git pull origin source  # update the local source branch
cd ./_deploy
git pull origin master  # update the local master branch
</code></pre>

<p>总结起来就是:<br/>
1. 从远端<code>source</code>和<code>master</code>同步数据<br/>
2. 写文章（或其他改动，例如更改theme）<br/>
3. push到远端<code>source</code>分支<br/>
4. <code>rake deploy</code>（相当于push到远端<code>master</code>分支）</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[git备忘录]]></title>
    <link href="http://www.orcame.com/blog/2013/12/26/git-memo/"/>
    <updated>2013-12-26T12:01:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/12/26/git-memo</id>
    <content type="html"><![CDATA[<h3>教程篇</h3>

<p><a href="http://pcottle.github.io/learnGitBranching/">这里</a>是一个在线演示git工作过程的网站，看起来很高端的样子，mark一下。</p>

<p><a href="https://code.csdn.net/DOC_CSDN/git_lxf">这里</a>是code.csdn.net上面的一个很不错的git教程，有文字，图片和视频</p>

<!--more-->


<h3>branch篇</h3>

<p>Clone一个远端分支</p>

<pre><code>git clone -b &lt;branch&gt; &lt;remote_repo&gt;
//for example
git clone -b my-branch git@github.com:user/respository.git
</code></pre>

<p>参考<a href="http://stackoverflow.com/questions/1911109/git-clone-a-specific-branch">这里</a></p>

<p>创建分支</p>

<pre><code>git branch &lt;branch&gt;
//for example
git branch newbranch
</code></pre>

<p>切换本地分支</p>

<pre><code>git checkout &lt;branch&gt;
</code></pre>

<p>创建远程分支，就是将本地分支push到远程</p>

<pre><code>git push origin &lt;branch&gt;
</code></pre>

<p>或者</p>

<pre><code>git push origin &lt;local_branch_name&gt;:&lt;remote_branch_name&gt;
</code></pre>

<h3>checkout篇</h3>

<p>当遇到本地和服务器上的代码有冲突</p>

<pre><code>git checkout filename 
</code></pre>

<p>用来撤销本地<strong>指定</strong>文件的更改</p>

<pre><code>git checkout -- .
</code></pre>

<p>用来撤销本地<strong>所有</strong>文件的更改</p>

<h3>url篇</h3>

<p>最近发现重新clone了代码做push操作的时候总是要输入用户名和密码，这非常讨厌，明明已经有了ssh key的。
找来找去，原因是clone的时候用的是<code>https</code>的地址，例如</p>

<pre><code>https://github.com/&lt;user-name&gt;/&lt;repository&gt;.git
</code></pre>

<p>这个地址是不会走ssh验证的，需要更改为</p>

<pre><code>git@github.com:&lt;user-name&gt;/&lt;repository&gt;.git
</code></pre>

<p>这个地址可以从repository主页上，点击右边的clone URL下面的<strong>SSH</strong>按钮获得
切换url的命令是</p>

<pre><code>git remote set-url origin git@github.com:&lt;user-name&gt;/&lt;repository&gt;.git
</code></pre>

<p>参考<a href="http://stackoverflow.com/questions/6565357/git-push-requires-username-and-password">这里</a></p>

<hr />

<p><strong><center>——未完待续中——</center></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[新换系统之吐槽ruby安装]]></title>
    <link href="http://www.orcame.com/blog/2013/12/25/xin-huan-xi-tong-zhi-tu-cao-rubyan-zhuang/"/>
    <updated>2013-12-25T22:53:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/12/25/xin-huan-xi-tong-zhi-tu-cao-rubyan-zhuang</id>
    <content type="html"><![CDATA[<p>手贱把Ubuntu搞挂了，不要问我怎么搞的，我也不知道。刚刚好，觉得那个Unity环境真是非常非常非常非常非常无法忍受的难用到无与伦比。听说有个家伙叫mint，用了都说好。<br/>
下载&#8211;烧U盘&#8211;安装，一通折腾后开始正式体验。初步印象感觉mint系统还不错啦，就是那个图标都是圆角是不是太土包子了？一看到那个默认的firefox图标我就想吐！罢了，反正也不用，删掉，装个chrome。装完了才发现，无比高端大气上档次的chrome图标居然也被系统弄成圆角方块疙瘩了。这瞬间变村姑啊，也忍了！
进入正题，把博客从github上clone下来之后，就又遇到了每次装系统必折腾之ruby版本问题。</p>

<!--more-->


<h3>我安装，我快乐</h3>

<p>对于Ruby，我是完全不懂，也不知道为什么要搞那么复杂。</p>

<p>既然需要1.9.3版本的，那先来<code>sudo apt-get install ruby1.9.3</code>，这一步没有任何问题，安装成功，执行<code>ruby -v</code>显示<code>ruby 1.9.3p194 (2012-04-20 revision 35410) [i686-linux]</code></p>

<h3>悲剧是怎样炼成的</h3>

<p>接下来进入blob文件夹根目录，执行<code>gem install bundler</code>,这一步顺利通过，悲剧马上来袭。当欢欢喜喜的执行<code>bundle install</code>时候，一个华丽丽的错误出现了</p>

<pre><code>Gem::Installer::ExtensionBuildError: ERROR: Failed to build gem native extension.

        /usr/bin/ruby1.9.1 extconf.rb 
/usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require': cannot load such file -- mkmf (LoadError)
    from /usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
    from extconf.rb:1:in `&lt;main&gt;'


Gem files will remain installed in /home/xxx/.bundler/tmp/21599/gems/RedCloth-4.2.9 for inspection.
Results logged to /home/xxx/.bundler/tmp/21599/gems/RedCloth-4.2.9/ext/redcloth_scan/gem_make.out

An error occurred while installing RedCloth (4.2.9), and Bundler cannot continue.
Make sure that `gem install RedCloth -v '4.2.9'` succeeds before bundling.
</code></pre>

<h3>rvm来了</h3>

<p>好吧，老老实实的Google，各种答案铺天盖地，看来看去呢，基本上都是要rvm。在终端中执行rvm试试看
提示可以通过 <code>sudo apt-get install ruby-rvm</code>来安装， so easy！ 但是敲了这段命令后，你会得到一个奇葩的结果<code>Error:未发现软件包ruby-rvm</code>o(╯□╰)o。哇哈哈，这都难不倒我的，google下rvm怎么安装。好么，要用到另一个名曰curl的家伙，这回apt-get是可以安装的。然后执行<code>curl -L https://get.rvm.io | bash -s stable</code> 就可安装rvm了。<br/>
<code>rvm -v</code>显示</p>

<pre><code>rvm 1.25.6 (stable) by Wayne E. Seguin &lt;wayneeseguin@gmail.com&gt;, Michal Papis &lt;mpapis@gmail.com&gt; [https://rvm.io/]
</code></pre>

<p>(ps:你得先执行<code>source ~/.rvm/scripts/rvm</code>载入rvm,不然bash又要提示你<code>sudo apt-get install ruby-rvm</code>了。)</p>

<h3>rvm傻了</h3>

<p>安装完rvm之后呢，执行<code>rvm install 1.9.3</code>，哇哈哈，过关斩将，毫不留情。这回<code>bundle install</code>试试看，错误依旧。( ⊙ o ⊙ )<br/>
没关系，再来，google到有人说要这样安装</p>

<figure class='code'><figcaption><span>sample code</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rvm pkg install openssl
</span><span class='line'>rvm install 1.9.3 --with-openssl-dir<span class="o">=</span><span class="nv">$rvm_path</span>/usr
</span></code></pre></td></tr></table></div></figure>


<p>这&#8230;和openssl什么关系？？？，不明觉历，姑且一试。
事实上，第一条命令就执行错误了</p>

<pre><code>Error running 'update_openssl_certs',
showing last 15 lines of /home/neeo/.rvm/log/1387980721/openssl.certs.log
</code></pre>

<p>第二条呢，是这样的结果</p>

<pre><code>Already installed ruby-1.9.3-p484.
To reinstall use:

    rvm reinstall ruby-1.9.3-p484

Gemset '' does not exist, 'rvm ruby-1.9.3-p484 do rvm gemset create ' first, or append '--create'.
</code></pre>

<p>根据提示，执行 <code>rvm ruby-1.9.3-p484 do rvm gemset create</code>
结果是</p>

<pre><code>Ruby ruby-1.9.3-p484 is not installed.
</code></pre>

<p>这一会儿说<strong>Already installed</strong>，一会儿又说<strong>not installed</strong>，是要闹哪样儿？？？</p>

<h3>问题解决</h3>

<p>回顾整个过程，在参照这篇<a href="http://ruby-china.org/wiki/install_ruby_guide">博客</a>，灵光一闪，会不会是因为用apt-get安装了ruby1.9.3的缘故？试试看吧，先执行<code>sudo apt-get remove ruby1.9.3</code>卸载掉。然后<code>rvm reinstall ruby-1.9.3-p484</code>经过非常非常非常无比漫长，洗了个澡依然没有结束的等待之后，再次执行<code>bundle install</code>，感谢郭嘉，顺利通过了。</p>

<h3>结论</h3>

<p>至于ruby是怎么回事儿？为什么这样安装会产生这样的问题？不知道。linux小白玩linux就是太折腾。最后再吐槽一下，新换的房子网络真是垃圾到爆了，各种卡有没有？各种loading没完没了有没有？看个优酷都只能标清还得缓冲有没有？室友忽悠我搬过来的时候还各种骄傲的说网络多么多么NB有没有？(╰_╯)</p>

<h3>后记</h3>

<p>第二天在新开的terminal下，又挂了，rake不工作，提示bundle install，然后重复问题出现，当时我就崩溃了。后来找到了两个解决方案
一个是<a href="http://stackoverflow.com/questions/12119138/failed-to-build-gem-native-extension-when-install-redcloth-4-2-9-install-linux">StackOverflow</a>上有人说看了<code>mkmf.log</code>文件（我没找到这个文件）后，得知是因为<code>gcc-4.2</code>没有安装的缘故，给出的解决方案是</p>

<pre><code>$ sudo ln -s /usr/bin/gcc /usr/bin/gcc-4.2
$ bundle install
</code></pre>

<p>我查看了下本机的<code>/usr/bin/</code>下也的确没有<code>gcc-4.2</code>，按照这种方式创建了一个<code>gcc</code>的引用，重新<code>bundle install</code>（我恨死这货了），依然是同样的问题。
后来，我找到了<a href="http://tarashish.com/blog/2013/02/02/fixing-mkmf-load-error-ubuntu/">这个</a>，执行了这个</p>

<pre><code>$ sudo apt-get install ruby1.9.1-dev
</code></pre>

<p>问题解决了</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[how to edit boot menu by bcedit]]></title>
    <link href="http://www.orcame.com/blog/2013/10/07/how-to-edit-boot-menu-by-bcedit/"/>
    <updated>2013-10-07T19:51:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/10/07/how-to-edit-boot-menu-by-bcedit</id>
    <content type="html"><![CDATA[<p>Copy your vm file(*.vhd for example) to a folder, D:\boot eg.</p>

<p>Open cmd as administrator</p>

<figure class='code'><figcaption><span>command line script</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="c">rem {current} is a identifier id. can also specifier the identifier id. This is used to backup the {current} setting, ignore it if you dont want. </span>
</span><span class='line'><span class="c">rem **strongly recommend**</span>
</span><span class='line'>bcdedit <span class="n">/copy</span> {current} <span class="n">/d</span> <span class="s2">&quot;current_backup&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c">rem set the device(the vhd file)</span>
</span><span class='line'>bcdedit <span class="n">/set</span> {current} device vhd<span class="o">=</span>[d:]\vhd path to file
</span><span class='line'><span class="c">rem bcdedit /set {current} device vhd=[d:]\boot\xxxx.vhd for example.</span>
</span><span class='line'>
</span><span class='line'><span class="c">rem set the osdevice(same path of the device)</span>
</span><span class='line'>bcdedit <span class="n">/set</span> {current} osdevice vhd<span class="o">=</span>[d:]\vhd path to file
</span><span class='line'>
</span><span class='line'><span class="c">rem set the default boot item(ignore this if you dont want make the new system as the default one)</span>
</span><span class='line'>bcdedit <span class="n">/set</span> {bootmgr} default {current} <span class="n">//guid.</span>
</span></code></pre></td></tr></table></div></figure>


<p>reboot os and enjoy the new system.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[简单的Go语言]]></title>
    <link href="http://www.orcame.com/blog/2013/08/11/jian-dan-de-goyu-yan/"/>
    <updated>2013-08-11T19:35:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/08/11/jian-dan-de-goyu-yan</id>
    <content type="html"><![CDATA[<p>最近小小的看了下Golang，这里记录一下相当初级的语法规则。</p>

<h2>Hello Go</h2>

<figure class='code'><figcaption><span>hello go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'><span class="kn">import</span> <span class="nx">fmt</span> <span class="s">&quot;fmt&quot;</span>  <span class="c1">// 导入fmt库，用于IO操作，这里import 相当于C中的#include</span>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, golang&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>import 还可以写成下面的样式</p>

<figure class='code'><figcaption><span>import 补充</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">import</span><span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;fmt&quot;</span>
</span><span class='line'>  <span class="s">&quot;math&quot;</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more -->


<h2>变量</h2>

<p>golang是<strong>静态语言</strong>，变量声明需要类型。
具体请看下面代码示例：</p>

<figure class='code'><figcaption><span>关于变量</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="c1">// 变量声明</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">i</span> <span class="kt">int</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">str</span> <span class="kt">string</span><span class="p">=</span><span class="s">&quot;hello golang&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 在一个语句中声明多个变量</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">z</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 可以根据变量值反推变量类型</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">value</span><span class="p">=</span><span class="mi">100</span><span class="c1">//这里的value是int类型</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 如果在**函数体内部**</span>
</span><span class='line'><span class="c1">// 可以这样声明变量</span>
</span><span class='line'><span class="kd">func</span> <span class="nx">demo</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">inner</span><span class="o">:=</span><span class="kc">true</span> <span class="c1">//这里相当于 var inner int=100</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>常量</h2>

<p>常量部分官方的说法是：</p>

<blockquote><ul>
<li>Constants are declared like variables, but with the const keyword.</li>
<li>Constants can be character, string, boolean, or numeric values.</li>
<li>Constants cannot be declared using the := syntax.</li>
</ul>
</blockquote>

<p>意思就是：</p>

<blockquote><ul>
<li>常量的声明和变量类似，用<strong>const</strong>关键字</li>
<li>常量只能是内置类型，例如:char,string,boolean,int,floag&#8230;</li>
<li>常量不能用 := 的方式声明</li>
</ul>
</blockquote>

<figure class='code'><figcaption><span>声明一个常量</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">const</span> <span class="nx">con</span> <span class="kt">string</span> <span class="p">=</span> <span class="s">&quot;这个是常量&quot;</span>
</span><span class='line'><span class="c1">//对比</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">val</span> <span class="kt">string</span> <span class="p">=</span> <span class="s">&quot;这是一个变量&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">const</span> <span class="nx">err</span> <span class="o">:=</span> <span class="s">&quot;这是错误的常量声明方式.&quot;</span>
</span><span class='line'><span class="c1">//对比</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">right</span> <span class="o">:=</span> <span class="s">&quot;这是正确的变量声明方式.&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>golang 的内置类型包括以下几种</p>

<blockquote><ul>
<li>bool</li>
<li>string</li>
<li>int, int8, int16, int32, int64</li>
<li>uint, uint8, uint16, uint32, uint64, uintptr</li>
<li>byte // alias for uint8</li>
<li>rune // alias for int32</li>
<li>float32, float64</li>
<li>complex64, complex128</li>
</ul>
</blockquote>

<h2>数组与切片</h2>

<h3>数组</h3>

<figure class='code'><figcaption><span>数组的定义</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">var</span> <span class="nx">arr</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="kt">int</span> <span class="c1">//这样定义的数组初始值为[0,0,0,0,0,0,0,0,0,0]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">arr</span><span class="o">:=</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span> <span class="c1">//这样的语句只能出现在function内部</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">arr2</span> <span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span> <span class="c1">//这是一个二维数组</span>
</span><span class='line'>
</span><span class='line'><span class="nb">len</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="c1">//用内置len方法获取数组长度</span>
</span></code></pre></td></tr></table></div></figure>


<h3>切片</h3>

<figure class='code'><figcaption><span>切片操作</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="nx">arr</span> <span class="o">:=</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">}</span>
</span><span class='line'><span class="nx">slice</span> <span class="o">:=</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="c1">//arr下标1～3的内容，不包括a[4]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">slice</span> <span class="p">=</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1">//arr[1] 到arr[4]，即1到结尾，包括结尾</span>
</span><span class='line'>
</span><span class='line'><span class="nx">slice</span> <span class="p">=</span><span class="nx">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="c1">//arr[0] 到arr[3], 不包括arr[4]</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意：</strong>数组的赋值是copy式的，见如下代码：</p>

<figure class='code'><figcaption><span>数组和切片的操作</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;fmt&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">arr1</span> <span class="o">:=</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span><span class="c1">//这样的声明是一个数组(长度是数组类型的一部分)</span>
</span><span class='line'>  <span class="nx">slice1</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span><span class="c1">//这样的声明是一个切片</span>
</span><span class='line'>  <span class="nx">arr2</span> <span class="o">:=</span><span class="nx">arr1</span> <span class="c1">//arr2是arr1的一个副本</span>
</span><span class='line'>  <span class="nx">slice2</span> <span class="o">:=</span><span class="nx">slice1</span> <span class="c1">//slice2是slice1的一个引用</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;arr1:&quot;</span><span class="p">,</span><span class="nx">arr1</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;arr2:&quot;</span><span class="p">,</span><span class="nx">arr2</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;slice1:&quot;</span><span class="p">,</span><span class="nx">slice1</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;slice2:&quot;</span><span class="p">,</span><span class="nx">slice2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">arr2</span><span class="p">[</span><span class="mi">3</span><span class="p">]=</span><span class="mi">100</span>
</span><span class='line'>  <span class="nx">slice2</span><span class="p">[</span><span class="mi">3</span><span class="p">]=</span><span class="mi">300</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;---after change arr2[3]=100 &amp; slice2[3]=300---&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;arr1:&quot;</span><span class="p">,</span><span class="nx">arr1</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;arr2:&quot;</span><span class="p">,</span><span class="nx">arr2</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;slice1:&quot;</span><span class="p">,</span><span class="nx">slice1</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;slice2:&quot;</span><span class="p">,</span><span class="nx">slice2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">slice4arr</span><span class="o">:=</span><span class="nx">arr1</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="c1">//slice4arr是对arr1[1,2,3]的一个引用</span>
</span><span class='line'>  <span class="nx">slice4arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]=</span><span class="mi">400</span> <span class="c1">//slice4arr[2]指向的是arr1[3]</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;---after change slice4arr[2]=400---&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;arr1:&quot;</span><span class="p">,</span><span class="nx">arr1</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;arr2:&quot;</span><span class="p">,</span><span class="nx">arr2</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;slice1:&quot;</span><span class="p">,</span><span class="nx">slice1</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;slice2:&quot;</span><span class="p">,</span><span class="nx">slice2</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>程序的输出是：</p>

<figure class='code'><figcaption><span>数组和切片操作结果</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="nx">arr1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">arr2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">slice1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">slice2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="o">---</span><span class="nx">after</span> <span class="nx">change</span> <span class="nx">arr2</span><span class="p">[</span><span class="mi">3</span><span class="p">]=</span><span class="mi">100</span> <span class="o">&amp;</span> <span class="nx">slice2</span><span class="p">[</span><span class="mi">3</span><span class="p">]=</span><span class="mi">300</span><span class="o">---</span>
</span><span class='line'><span class="nx">arr1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">arr2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">100</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">slice1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">300</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">slice2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">300</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="o">---</span><span class="nx">after</span> <span class="nx">change</span> <span class="nx">slice4arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]=</span><span class="mi">400</span><span class="o">---</span>
</span><span class='line'><span class="nx">arr1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">400</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">arr2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">100</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">slice1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">300</span> <span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="nx">slice2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">300</span> <span class="mi">5</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>if语句</h2>

<p>golang中if语句是没有小括号()的，但必须包括花括号{},并且<strong>{符号不能放置在下一行</strong>（这个约定其实和golang中的分号;有关)</p>

<figure class='code'><figcaption><span>if 语句</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="c1">//这是正确的写法</span>
</span><span class='line'><span class="k">if</span> <span class="kc">true</span><span class="p">{</span>
</span><span class='line'>  <span class="c1">//do something...</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//这是错误的写法</span>
</span><span class='line'><span class="k">if</span> <span class="kc">true</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">//do something...</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//if -else if -else 语句</span>
</span><span class='line'><span class="k">if</span> <span class="nx">a</span><span class="p">&gt;</span><span class="mi">0</span><span class="p">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="nx">a</span><span class="o">==</span><span class="mi">0</span><span class="p">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>switch 语句</h2>

<p>switch 同if一样没有小括号，但必须有花括号。case不需要break，可以用逗号分割多个值.<strong>{符号不能放置在下一行</strong></p>

<figure class='code'><figcaption><span>switch 语句</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="k">switch</span> <span class="nx">value</span><span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>      <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;eq one&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span>
</span><span class='line'>      <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;lt five&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">default</span><span class="p">:</span>
</span><span class='line'>      <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="err">&quot;</span><span class="nx">lt</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">gt</span> <span class="nx">four</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>for 循环</h2>

<p>golang中for循环有三种形式, 同if一样没有小括号，但必须有花括号。<strong>{符号不能放置在下一行</strong></p>

<figure class='code'><figcaption><span>for loop</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="c1">//init;condition;post 形式</span>
</span><span class='line'><span class="k">for</span> <span class="nx">idx</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">idx</span><span class="p">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span><span class="nx">idx</span><span class="o">++</span><span class="p">{</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//only condition 形式</span>
</span><span class='line'>
</span><span class='line'><span class="nx">idx</span><span class="o">:=</span><span class="mi">0</span>
</span><span class='line'><span class="k">for</span> <span class="nx">idx</span><span class="p">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="nx">arr</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
</span><span class='line'>  <span class="nx">idx</span><span class="o">++</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//forever</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">{</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Never die&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong><em>golang 中没有 while语句，for语句已经包含了while的功能</em></strong></p>

<h2>函数</h2>

<p>golang中函数的声明和C略有不同，返回值类型放在了后面</p>

<figure class='code'><figcaption><span>golang中的函数声明</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">func</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">a</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//也可以写成下面这样：</span>
</span><span class='line'><span class="kd">func</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//函数可以有不定个数的参数</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">values</span> <span class="o">...</span><span class="kt">int</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">total</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span><span class="nx">v</span> <span class="o">:=</span><span class="k">range</span> <span class="nx">values</span><span class="p">{</span>
</span><span class='line'>              <span class="c1">//这里用了一个变量 _，golang中如果一个变量声明了但没有使用是不允许的，所以有了这个特殊的_</span>
</span><span class='line'>              <span class="c1">//对于_，golang在编译的时候不会做0使用的验证。如果需要访问下标，可以写作for idx,value :=range values....</span>
</span><span class='line'>      <span class="nx">total</span><span class="o">+=</span><span class="nx">v</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">total</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//函数还可以闭包，熟悉js的人对这个不会陌生</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">next</span><span class="p">()</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">int</span><span class="p">{</span>
</span><span class='line'>  <span class="nx">i</span><span class="o">:=</span><span class="mi">0</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">func</span><span class="p">()</span><span class="kt">int</span><span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">i</span><span class="o">++</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//调用：</span>
</span><span class='line'><span class="nx">nextInt</span> <span class="o">:=</span><span class="nx">next</span><span class="p">()</span>
</span><span class='line'><span class="k">for</span><span class="p">{</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">nextInt</span><span class="p">())</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>结构体</h2>

<p>还是看代码吧</p>

<figure class='code'><figcaption><span>结构体</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">type</span> <span class="nx">Panda</span> <span class="kd">struct</span><span class="p">{</span>
</span><span class='line'>  <span class="nx">name</span> <span class="kt">string</span>
</span><span class='line'>  <span class="nx">weight</span> <span class="kt">int</span>
</span><span class='line'>  <span class="nx">description</span> <span class="kt">string</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//结构体的初始化有一下几种方式</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">paul</span> <span class="nx">Panda</span><span class="p">=</span><span class="nx">Panda</span><span class="p">{</span><span class="s">&quot;Paul&quot;</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="s">&quot;神龙大侠&quot;</span><span class="p">}</span>
</span><span class='line'><span class="c1">//或者</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">paul</span> <span class="nx">Panda</span><span class="p">=</span><span class="nx">Panda</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="s">&quot;Paul&quot;</span><span class="p">,</span><span class="nx">description</span><span class="p">:</span><span class="s">&quot;神龙大侠&quot;</span><span class="p">,</span><span class="nx">weight</span><span class="p">:</span><span class="mi">1000</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>结构体的方法是比较特殊的，同C#等不同，不能在结构体内部声明，需要如此这般</p>

<figure class='code'><figcaption><span>结构体方法</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">Panda</span><span class="p">)</span> <span class="nx">Box</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;打出一记肥猫拳&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">Panda</span><span class="p">)</span> <span class="nx">Kick</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;佛山无影脚，阿达～～～～&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意:</strong> golang中没有访问限制关键之，public，private，protected等，约定首字母大写的方法即为public(可以被别的包访问)</p>

<h2>接口</h2>

<p>接口是这样定义的</p>

<figure class='code'><figcaption><span>interface定义</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">type</span> <span class="nx">swordsman</span> <span class="kd">interface</span><span class="p">{</span> <span class="c1">//大侠会打拳和踢人</span>
</span><span class='line'>  <span class="nx">Box</span><span class="p">()</span>
</span><span class='line'>  <span class="nx">Kick</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意</strong> golang中的接口是不需要显示继承的，golang认为有A的功能就是一个A，这里就是<strong>会打拳和踢人的就是大侠</strong>，那么Panda已经实现了swordsman接口，paul是一个大侠了</p>

<figure class='code'><figcaption><span>看看作为大侠的paul</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">var</span> <span class="nx">paul</span> <span class="nx">Panda</span><span class="p">=</span><span class="nx">Panda</span><span class="p">{</span><span class="s">&quot;Paul&quot;</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="s">&quot;神龙大侠&quot;</span><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">sw</span> <span class="nx">swardsman</span><span class="p">=</span><span class="o">&amp;</span><span class="nx">paul</span>
</span><span class='line'><span class="nx">sw</span><span class="p">.</span><span class="nx">Box</span><span class="p">()</span>
</span><span class='line'><span class="nx">sw</span><span class="p">.</span><span class="nx">Kick</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>关于分号;</h2>

<p>golang 的唯一需要分号的地方是作为for循环中的init;condition;post分割符;在编译代码过程中，词法分析器会自动的为代码添加上分号，所以写代码的时候不需要写分号。词法分析器添加分号的规则是：</p>

<blockquote><p>行尾最后一个token（这当然不包括注释）是一个标识符，数值、字符串等字面值，或者++,&#8211;,break, fallthrough,continue, return中的一个</p></blockquote>

<p>按照以上规则，<strong>千万不要尝试在将for，switch，if等代码体的{写到下一行，因为这样会导致在{之前加入一个分号(;),引起错误。</strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[愿生者平安，逝者安息]]></title>
    <link href="http://www.orcame.com/blog/2013/04/21/for-yaan/"/>
    <updated>2013-04-21T22:02:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/04/21/for-yaan</id>
    <content type="html"><![CDATA[<p> <img src="http://www.orcame.com/images/image-post/yaan.jpg"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[测试代码高亮]]></title>
    <link href="http://www.orcame.com/blog/2013/03/04/code-hightlight/"/>
    <updated>2013-03-04T22:47:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/03/04/code-hightlight</id>
    <content type="html"><![CDATA[<h2>Javascript</h2>

<figure class='code'><figcaption><span>这是一段javascript代码</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;click on &#39;</span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more -->


<h2>C</h2>

<figure class='code'><figcaption><span>这是一段C语言代码</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>C Sharp</h2>

<figure class='code'><figcaption><span>这是一段C#代码</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Human</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="kt">string</span> <span class="n">name</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nf">Human</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">){</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="n">name</span><span class="p">=</span><span class="n">name</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SayHi</span><span class="p">(){</span>
</span><span class='line'>      <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Hi, I am {0}. Nice to meet you.&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="n">name</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Golang</h2>

<figure class='code'><figcaption><span>这是一段golang代码</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nx">fmt</span> <span class="s">&quot;fmt&quot;</span>  <span class="c1">// Package implementing formatted I/O.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, world; or Καλημέρα κόσμε; or こんにちは 世界\n&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Python</h2>

<figure class='code'><figcaption><span>这是一段Python代码</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="c"># Filename: mymodule.py</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">sayhi</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="s">&#39;Hi, this is mymodule speaking.&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># End of mymodule.py</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GitHub + Octopress 搭建个人Blog]]></title>
    <link href="http://www.orcame.com/blog/2013/03/02/hello-git-world/"/>
    <updated>2013-03-02T16:25:00+08:00</updated>
    <id>http://www.orcame.com/blog/2013/03/02/hello-git-world</id>
    <content type="html"><![CDATA[<h2>预备知识</h2>

<h3>Octopress是什么？</h3>

<p>Octopress是一个基于jekyll的博客系统，用Ruby语言编写。Octopress使用静态页面，内容不依赖于数据库，可以使用纯文本，HTML，markdown标记语言写文章。</p>

<!-- more -->


<h3>jekyll是什么?</h3>

<p>请看<a href="http://jekyllrb.com/">这里</a>和<a href="http://www.soimort.org/posts/101/">这里</a></p>

<h3>markdown是什么?</h3>

<p>直接看这个<a href="http://wowubuntu.com/markdown/">教程</a>或这个<a href="http://equation85.github.com/blog/markdown-examples/">教程+示例</a></p>

<h3>github是什么？</h3>

<p>老兄，你out了，自己Google去(友情提示，为了宇宙的安宁，远离baidu)。<br/>
哦，别忘了注册一个Github的账号，稍后有用。</p>

<h2>准备环境</h2>

<h3>安装git</h3>

<p>到<a href="http://www.github.com">github</a>上下载<a href="https://help.github.com/articles/set-up-git">安装包</a>。<br/>
配置github，执行</p>

<pre><code>ls ~/.ssh  
</code></pre>

<p>若结果为</p>

<pre><code>id_rsa  id_rsa.pub  known_hosts
</code></pre>

<p>执行</p>

<pre><code>mv ~/.ssh ~/.ssh_backup  
</code></pre>

<p>备份ssh key，执行</p>

<pre><code>ssh-keygen -t rsa -C "你的邮箱地址，例如yourname@gmail.com"
&lt;span color="green"&gt;Generating public/private rsa key pair.&lt;/span&gt;
&lt;span color="green"&gt;Enter file in which to save the key (/Users/your_user_directory/.ssh/id_rsa):&lt;/span&gt;  #此处直接回车   

Enter passphrase (empty for no passphrase):  #此处输入加密串，输入状态是看不到的
Enter same passphrase again:  #确认刚刚输入的加密串
</code></pre>

<p>目前为止，成功生成SSH key，在github上的账号设置中，<strong>添加新的SSH key</strong> ，随便起个名字，将<code>~/.ssh</code>目录下的文件<code>id_rsa.pub</code>中的内容黏贴到Key域中。</p>

<p>执行</p>

<pre><code>ssh -T git@github.com
</code></pre>

<p>会提示</p>

<pre><code>The authenticity of host 'github.com (207.97.227.243)' can't be established.
RSA key fingerprint is xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:4d:ae:34:ed:76.
Are you sure you want to continue connecting (yes/no)?
</code></pre>

<p>莫要惊慌，直接输入<code>yes</code></p>

<pre><code>Hi xxxxx! You've successfully authenticated, but GitHub does not provide shell access.
</code></pre>

<p>然后执行</p>

<pre><code>git config --global user.name "your_name"
git config --global user.email "your_mail_box_address"  
</code></pre>

<p>到github上面创建一个名称为yourusername.github.com的pro，过程很简单，如不会创建，请google</p>

<p>大功告成了一小步。</p>

<h3>安装Ruby</h3>

<p>执行<code>ruby -v</code>查看系统版本号，如果不低于<strong>1.9.3</strong>, 跳过此步骤 <br/>
安装步骤请看这个<a href="http://ruby-china.org/wiki/install_ruby_guide">教程</a>,需要<strong>注意</strong>的是，我们要安装的版本为<span style="color:red">1.9.3</span>，将教程中的版本号(如果低于1.9.3)替换为1.9.3<br/>
安装好Rubby后，执行<code>rvm use 1.9.3</code>更改版本号，若出现</p>

<pre><code>RVM is not a function, selecting rubies with 'rvm use ...' will not work.

You need to change your terminal emulator preferences to allow login shell.
Sometimes it is required to use `/bin/bash --login` as the command.
Please visit https://rvm.io/integration/gnome-terminal/ for a example.
</code></pre>

<p>在终端窗口中 编辑-配置文件首选项-标题和命令-勾选 以登录Shell方式运行命令 ，重启终端后重新执行 <code>rvm use 1.9.3</code>，如顺利通过，恭喜你，走出了阿母斯特朗的一小步。</p>

<h3>安装Octopress</h3>

<pre><code>git clone git://github.com/imathis/octopress.git your_blog_folder #获取octopress
cd your_blog_folder    #如果有提示（提升ruby版本号),yes到底  

gem install bundler 
bundle install  

rake install
</code></pre>

<h3>配置Octopress</h3>

<p>在your_blog_folder下面有一个<code>_config.yml</code>文件，编辑该文件的内容</p>

<pre><code>url: yourusername.github.com
title: your blog title
subtitle: your blog sub title
author: your name
simple_search: http://google.com/search
description: your blog descritpion.
......
</code></pre>

<p>内容很简单，以您的智慧，想不懂都难，需要注意的是每一项key和value之间的 冒号(:)后面是有一个 <strong>空格</strong> 的，否则会报错。</p>

<h2>发表博客</h2>

<h3>写文章</h3>

<p>执行</p>

<pre><code>rake new_post["hello github"] 
</code></pre>

<p>会在”your_blog_folder/source/_post”下生成一个xx.makedown文件，用您在<a href="http://wowubuntu.com/markdown/">这里</a>或<a href="http://equation85.github.com/blog/markdown-examples/">这里</a>学到的markdown语法来编辑文章就行了。</p>

<p>执行</p>

<pre><code>rake generate
rake preview
</code></pre>

<p>打开 localhost:4000 预览博客</p>

<h3>发表文章</h3>

<p>预览文章没有问题了，执行</p>

<pre><code>rake deploy
</code></pre>

<p>发布博客，等待一段时间，大概10分钟。打开http://yourusername.github.com 就可以访问刚刚生成的博客了。</p>

<h3>绑定域名</h3>

<p>如果需要绑定域名，可以在your_blog_folder目录下面建立一个名称为<code>CNAME</code>的文本文件，注意无后缀名，内容为</p>

<pre><code>www.yourdomain.com
</code></pre>

<p>然后在你的域名提供商处将DNS改为<code>204.232.175.78</code>(pages.github.com的IP地址，可以ping一下，以获取的内容为准)<br/>
等待一段时间后域名生效，就可以通过www.yourdomain.com访问博客了。（留意您的邮箱，有错误github会提示您的）</p>
]]></content>
  </entry>
  
</feed>
